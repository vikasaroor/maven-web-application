node {
    try {
	
properties([buildDiscarder(logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '', daysToKeepStr: '10', numToKeepStr: '10')), [$class: 'JobLocalConfiguration', changeReasonComment: ''], pipelineTriggers([pollSCM('* * * * *')])])

def mavenhome = tool name: 'maven3.8.6'

stage ('checkout code'){
git branch: 'development', credentialsId: 'e820db54-3a90-4e00-b4a5-8fd92032dc16', url: 'https://github.com/vikasaroor/maven-web-application.git'
}

//build stage
stage ('build'){
sh "${mavenhome}/bin/mvn package"
}
}//try end

catche(e) {
currentBuild.result = "FAILURE"
throw e
}//catch end

finally {
notifyBuild(currentBuild.result)
}//finally end
}// node end

def notifySlack(String buildStatus = 'STARTED') {
    // Build status of null means success.
    buildStatus = buildStatus ?: 'SUCCESS'

    def color

    if (buildStatus == 'STARTED') {
        color = '#D4DADF'
    } else if (buildStatus == 'SUCCESS') {
        color = '#BDFFC3'
    } else if (buildStatus == 'UNSTABLE') {
        color = '#FFFE89'
    } else {
        color = '#FF9FA1'
    }

    def msg = "${buildStatus}: `${env.JOB_NAME}` #${env.BUILD_NUMBER}:\n${env.BUILD_URL}"

    slackSend(color: color, message: msg)
}
